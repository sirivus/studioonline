

var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(a,b){this.$jscomp$symbol$id_=a;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:b})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function a(c){if(this instanceof a)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(c||"")+"_"+b++,c)}var b=0;return a}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.asyncIterator;a||(a=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,f=0;f<d;f++){var g=a[f];if(b.call(c,g,f,a))return{i:f,v:g}}return{i:-1,v:void 0}};$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};
$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(a,c){return $jscomp.findInternal(this,a,c).v}},"es6","es3");
var ajaxQ=null,canTrain=!1,shift=0,sbopen=!1,eqopen=!1,ttElement=null,TT=null,tt=1,cdActive="",cdX=0,cdY=0,cdStartX=0,cdStartY=0,cdInfo="",last_cdInfo,cdElement=null,ddX=0,ddY=0,ddStartX=0,ddStartY=0,dragElement=null,ddActive=!1,ddInfo=null,scY=0,scStartY=0,cY=0,cStartY=0,BEL=0,scrollSpeed=-3,scrollTop=!1,scrollBottom=-485,UIElements=[],worldUrl="receive.php",SETTINGS=null;function gel(a){return a?"string"==typeof a?document.getElementById(a):a:null}function getE(a){return gel(a)}
function getExt(a){return a.split(".").pop()}function log(a,b){b=b||null;console&&(b&&1!=b||console.log(a))}function preventDefault(a){a&&a.preventDefault&&a.preventDefault()}function getDocHeight(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}
function isIterable(a){if(null==a)return!1;$jscomp.initSymbol();$jscomp.initSymbolIterator();return"function"===typeof a[Symbol.iterator]}function isFullScreen(){return!0===document.fullscreen||!0===window.fullScreen||!0===document.webkitIsFullScreen}function toggleFullScreen(){isFullScreen()?closeFullscreen():openFullscreen()}function setFullScreenIcon(){var a=isFullScreen()?"close_fullscreen.png":"fullscreen.png",b=gel("fullscreen_img");b&&(b.src="/img/icons/"+a)}
function openFullscreen(){var a=document.documentElement;a.requestFullscreen?a.requestFullscreen():a.mozRequestFullScreen?a.mozRequestFullScreen():a.webkitRequestFullscreen?a.webkitRequestFullscreen():a.msRequestFullscreen&&a.msRequestFullscreen()}
function closeFullscreen(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}function inArray(a,b){var c=b.length,d;for(d=0;d<c;d++)if(b[d]==a)return!0;return!1}function guid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})}
navigator.sayswho=function(){var a=navigator.userAgent,b=navigator.appName,c,d=a.match(/(opera|chrome|safari|firefox|msie|trident)\/?\s*([\d\.]+)/i)||[];(d=d[2]?[d[1],d[2]]:[b,navigator.appVersion,"-?"],null!=(c=a.match(/version\/([\.\d]+)/i)))&&(d[2]=c[1]);return d.join(" ")}();function rightClick(a){var b=!1;a=a||window.event;a.which?b=3==a.which:a.button&&(b=2==a.button);return b}
window.mobilecheck=function(){var a=!1;if(-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("IsMobile")||/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return!0;var b=navigator.userAgent||navigator.vendor||window.opera;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(b)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|mobile|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,
4)))a=!0;return a};function submitForm(a){(a=getE(a))?a.submit():log("no form")}function replaceHTML(a,b){if(a="string"===typeof a?getE(a):a){var c=a.cloneNode(!1);c.innerHTML=b;a.parentNode.replaceChild(c,a)}return c}function getSelectedText(a){a=getE(a);return document.selection?document.selection.createRange().text:a.value.substring(a.selectionStart,a.selectionEnd)}
function appendBB(a,b){var c=getE(a);c&&(a=getSelectedText(a),c.value=a?c.value.replace(a,"["+b+"]"+a+"[/"+b+"]"):c.value+"["+b+"][/"+b+"]")}function replaceHTML2(a,b){a=getE(a);var c=a.nextSibling;var d=a.parentNode;log(a);var f=a.style.display||"block";a.style.display="none";d.removeChild(a);a.innerHTML=b;c?d.insertBefore(a,c):d.appendChild(a);a.style.display=f}function replaceHTML4(a,b){a&&(a.innerHTML=b)}function scrollToBottom(a){if(a=gel(a))a.scrollTop=a.scrollHeight}var rewOpt=0;
function rewLink(){return 0<rewOpt?"&rwd="+rewOpt:""}function getNodesByTag(a,b,c,d){var f,g,h=[],k,m;if(a=getE(a)){a=a.childNodes;var l=a.length;for(k=0;k<l;k++)if(f=a[k])if(f.tagName!=b||d!=f.type&&d||h.push(f),f.childNodes.length&&c){f=getNodesByTag(f,b,!0);var n=f.length;for(m=0;m<n;m++)(g=f[m])&&(g.tagName!=b||d!=g.type&&d||h.push(g))}}return h}
function submitAjaxForm(a,b,c){var d=[];var f="";if(a=getE(a)){f=getNodesByTag(a,"INPUT",!0,b);var g=getNodesByTag(a,"SELECT",!0,b);b=getNodesByTag(a,"TEXTAREA",!0,b);f=$.merge(f,g);f=$.merge(f,b);g=f.length;for(a=0;a<g;a++)if((b=f[a])&&!b.dataset.ignore){var h=b.type.toLowerCase();var k=encodeURIComponent(b.value);if(!k&&$(b).prop("required"))return d='Field "'+b.name+'" is required.',(c=getE(c))?c.innerHTML=d:alert(d),!1;if("radio"==h)b.checked&&d.push(b.name+"="+k);else if("checkbox"==h)b.checked?
d.push(b.name+"="+k):d.push(b.name+"=0");else if("button"!=h&&"submit"!=h&&"reset"!=h)if(b.multiple)for(h=0,k=b.length;h<k;h++)d.push(b.name+"="+b[h].value);else d.push(b.name+"="+k)}f="&"+d.join("&")}return f}function updateVideoSettings(){kajax("action=update"+submitAjaxForm("video_settings_form"),null,function(a){if(a=JSON.parse(a))a.settings?(unloadWindow("video_settings"),ENGINE.reload(a,!0)):location.reload()},"/video_settings.php")}
function initSetHotkey(a){a&&getE("hotkeys")&&(loadPopWindow("setkey",null,200,30).innerHTML='<div style="text-align:center;">Press the key for '+a.id+"</div>",document.onkeyup=function(b){document.onkeyup=function(a){ENGINE.CONTROLS.canvasKeyUp(a)};setHotKey(b,a)})}
function setHotKey(a,b){if(b){a=a||window.event;var c=!1;switch(b.id){case "AUTO_CENTER":c=b.checked?1:0;break;case "POINTER_LOCK":c=b.checked?1:0;break;default:c=a.keyCode}!1!==c&&kajax("action=update&id="+b.id+"&key="+c,"hotkeys",function(a){a=JSON.parse(a);a.html&&ENGINE.handleHTML(a.html);ENGINE.CONTROLS.HOTKEYS[b.id]=c;unloadWindow("setkey")},"/hotkeys.php")}}
function resetHotKeys(){kajax("action=reset","hotkeys",function(a){a=JSON.parse(a);a.html&&ENGINE.handleHTML(a.html);a.hotkeys&&(ENGINE.CONTROLS.HOTKEYS=JSON.parse(a.hotkeys));unloadWindow("setkey")},"/hotkeys.php")}function invMenu2(a){a=getE(a);var b,c;if(a){var d=getE("hmenus").childNodes;if(c=d.length)for(b=0;b<c;b++)d[b].style.display="none";a.style.display=""}}
function relMouseCoords(a,b){b=b||window.event;a=getE(a);var c=0,d=0,f=0,g=0,h=b.pageX||b.clientX;b=b.pageY||b.clientY;if(a){do c+=a.offsetLeft,d+=a.offsetTop;while(a=a.offsetParent);f=h-c;g=b-d}return{x:f,y:g}}function ceil(a){return(0<=a||-1)*Math.ceil(Math.abs(a))}function floor(a){return(0<=a||-1)*Math.floor(Math.abs(a))}function round(a){return(0<=a||-1)*Math.round(Math.abs(a))}
function number_format(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");a=isFinite(+a)?+a:0;b=isFinite(+b)?Math.abs(b):0;d="undefined"===typeof d?",":d;c="undefined"===typeof c?".":c;var f="";f=function(a,b){b=Math.pow(10,b);return""+Math.round(a*b)/b};f=(b?f(a,b):""+Math.round(a)).split(".");3<f[0].length&&(f[0]=f[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,d));(f[1]||"").length<b&&(f[1]=f[1]||"",f[1]+=Array(b-f[1].length+1).join("0"));return f.join(c)}
function clickDrop(a,b,c,d){var f=gel("kCD");if(f){if(cdInfo!=d&&last_cdInfo!=d){var g=d.toString().split("-");cdInfo=d;null==a&&(a=window.event);switch(c){case "spell":b='<img src="img/spells/'+g[0]+'.jpg" height=35px width=35px border=0>';break;case "item":case "gem":case "boat":case "equip":b='<img src="img/items/'+g[0]+'.jpg" height=35px width=35px border=0>';break;default:b=b.innerHTML}f.innerHTML=b;cdActive=c;cdElement=f;c=a.clientY+5;a=a.clientX+5;f.style.top=c+"px";f.style.left=a+"px";cdX=
a;cdY=c;cdStartX=a;cdStartY=c;f.style.display="block";document.onmousemove=moveElement;document.onmousedown=cdDown;document.body.focus()}else unkCD(a);return!1}}function unkCD(a){last_cdInfo=cdInfo;cdInfo=cdActive="";cdElement&&(cdElement.innerHTML="",cdElement.style.display="none",cdElement=null);document.onmousemove=null;document.onmousedown=null;return!0}
function cdDown(a){a=window.event||a;var b="";if(cdActive){var c=null!=a.target?a.target:a.srcElement;if(c){var d=$(c),f="";d.data("key")&&(f=d.data("key"));if(f!=cdInfo&&(b=handle_cdDown(a,c),!0===b))return!1}if("bypass"==b)return!0}unkCD(a);return!1}
function handle_cdDown(a,b){var c=$(b);if(c.hasClass("cdoverRide"))return!0;switch(cdActive){case "spell":if(c.hasClass("spell")){var d=c.data("key").toString(),f=d.split("-"),g=parseInt(f[2]);ENGINE.spellOrder(cdInfo,g);if(!c.hasClass("spell_empty")&&parseInt(f[2])&&d!=cdInfo)return clickDrop(a,b,cdActive,d),!0}else ENGINE.spellOrder(cdInfo);break;case "equip":c.hasClass("equip")&&(a=cdInfo.split("-"),d=c.data("key").toString(),f=d.split("-"),f[1]==a[2]&&ENGINE.equipItem(a[1],a[2]));break;case "item":if(c.hasClass("item")){if(d=
c.data("key").toString(),f=d.split("-"),g=parseInt(f[1]),ENGINE.itemOrder(cdInfo,g),!c.hasClass("spell_empty")&&parseInt(f[0])&&d!=cdInfo)return clickDrop(a,b,cdActive,d),!0}else ENGINE.itemOrder(cdInfo);break;case "gem":if(c.hasClass("socket"))return d=c.data("key").toString(),f=d.split("-"),loadSocketWindow(a,f[0]),"bypass";break;case "boat":switch(b.className){case "cdoverRide":return!0;default:window.ENGINE&&ENGINE.upgradeBoat(cdInfo,b.id)}}return!1}
function highlightEquipment(){$(".spell_empty.item").css("opacity","0.7")}function dimEquipment(){$(".spell_empty.item").css("opacity","0.25")}function highlightSpells(){$(".spell_empty.spell").css("opacity","0.7")}function dimSpells(){$(".spell_empty.spell").css("opacity","0.25")}
function moveElement(a){a=a||window.event;if(a){var b=a.pageY||a.clientY,c=a.pageX||a.clientX;cdElement&&(a=cdElement)&&(a.style.display="block",a.style.left=cdX+c-cdStartX+5+"px",a.style.top=cdY+b-cdStartY+5+"px");if(ttElement&&(a=getE("kTT"))){a.style.display="block";var d=document.body.clientWidth+parseInt(document.body.scrollLeft);parseInt(document.body.scrollTop);var f=a.offsetWidth;var g=c+15,h=b-a.offsetHeight-5;c+f+20>d&&(g-=f+20);5>h&&(h=5);a.style.left=g+"px";a.style.top=h+"px"}dragElement&&
(a=dragElement)&&(a.style.display="block",d=document.body.offsetWidth,f=document.body.offsetHeight,c=isNaN(parseInt(a.style.right))?ddX+c-ddStartX:ddStartX-c+ddX,b=isNaN(parseInt(a.style.bottom))?ddY+b-ddStartY:ddStartY-b+ddY,isNaN(parseInt(a.style.right))?0>c?c=0:c>d&&(c=d):0>c?c=0:c>d-a.offsetWidth&&(c=d-a.offsetWidth),isNaN(parseInt(a.style.bottom))?30>b?b=30:b>f&&(b=f):0>b?b=0:b>f-a.offsetHeight+30&&(b=f-a.offsetHeight+30),isNaN(parseInt(a.style.right))?a.style.left=c+"px":a.style.right=c+"px",
isNaN(parseInt(a.style.bottom))?a.style.top=b+"px":a.style.bottom=b+"px");return!0}return!1}function InitDragDrop(a){if(dragElement=getE(a))document.onmousedown=ddDown,document.onmouseup=ddUp}function EndDragDrop(){document.onmouseup=null;document.onselectstart=function(){return!0};cdActive?(document.onmousemove=moveElement,document.onmousedown=cdDown):(document.onmousedown=null,document.onmousemove=null);handleDD();ddActive=dragElement=!1;ddInfo=null}
function handleDD(){if(ddActive)switch(ddActive){case "ui":var a=parseInt(dragElement.style.left),b=parseInt(dragElement.style.top),c=parseInt(dragElement.style.right),d=parseInt(dragElement.style.bottom),f=["task=updateui"];f.push("ui="+ddInfo);isNaN(a)||f.push("x="+a);isNaN(b)||f.push("y="+b);isNaN(c)||f.push("r="+c);isNaN(d)||f.push("b="+d);f=f.join("&");kajax(f,null,function(a){ENGINE.doUpdate(a)},"/receive.php")}}function ddUp(){EndDragDrop()}
function ddDown(a){return(a=window.event||a)&&(1==a.button&&null!=window.event||0==a.button)&&dragElement?("window"==dragElement.className&&("50%"==dragElement.style.left&&(dragElement.style.marginLeft="0px",dragElement.style.left=dragElement.offsetLeft-dragElement.offsetWidth/2+"px"),"50%"==dragElement.style.top&&(dragElement.style.marginTop="0px",dragElement.style.top=dragElement.offsetTop-dragElement.offsetHeight/2+"px")),ddX=isNaN(parseInt(dragElement.style.left))?parseInt(dragElement.style.right):
parseInt(dragElement.style.left),ddY=isNaN(parseInt(dragElement.style.top))?parseInt(dragElement.style.bottom):parseInt(dragElement.style.top),ddStartX=a.clientX||a.pageX,ddStartY=a.clientY||a.pageY,document.onmousemove=moveElement,document.body.focus(),document.onselectstart=function(){return!1},dragElement.ondragstart=function(){return!1},!1):dragElement=!1}
function ddMove(a){if(dragElement&&(a=window.event||a,a)){var b=document.body.offsetWidth;var c=document.body.offsetHeight;resetZint2();var d=ddY+(a.pageY||a.clientY)-ddStartY+"px";dragElement.style.left=ddX+(a.pageX||a.clientX)-ddStartX+"px";dragElement.style.top=d;if(UIElements[dragElement.id]){isNaN(parseInt(dragElement.style.right))?(a=parseInt(dragElement.style.left),b=a+parseInt(dragElement.offsetWidth)):(b-=parseInt(dragElement.style.right),a=b-dragElement.offsetWidth);isNaN(parseInt(dragElement.style.bottom))?
(c=parseInt(dragElement.style.top),d=c+parseInt(dragElement.offsetHeight)):(d=c-parseInt(dragElement.style.bottom),c=d-dragElement.offsetHeight);var f=screen.width-b;var g=screen.height-d;UIElements[dragElement.id]=[c,b,d,a,c,f,g,a]}return!1}}function resetUI(){kajax("task=resetUI&browser="+navigator.sayswho+"&res_y="+window.screen.height+"&res_x="+window.screen.width,null,function(a){location.reload()},"/receive.php")}
function repositionUI(){var a,b,c;if(a=getE("master")){var d=document.body.offsetWidth;var f=document.body.offsetHeight;var g=a.childNodes.length;for(c=0;c<g;c++)(b=a.childNodes[c])&&"canvas"!=b.id&&"renderer"!=b.id&&b.style&&"absolute"==b.style.position&&(isNaN(parseInt(b.style.right))?0>parseInt(b.style.left)?b.style.left="0px":parseInt(b.style.left)>d-b.offsetWidth&&(b.style.left=d-b.offsetWidth+"px"):0>parseInt(b.style.right)?b.style.right="0px":parseInt(b.style.right)>d-b.offsetWidth&&(b.style.right=
d-b.offsetWidth),isNaN(parseInt(b.style.bottom))?30>parseInt(b.style.top)?b.style.top="30px":parseInt(b.style.top)>f&&(b.style.top=f-b.offsetHeight+"px"):0>parseInt(b.style.bottom)?b.style.bottom="0px":parseInt(b.style.bottom)>f-b.offsetHeight+30&&(b.style.bottom=f-b.offsetHeight+30+"px"))}}
function toggleUI(){var a,b;ENGINE.mc.get("modelArray");if(a=getE("master")){var c=a.childNodes.length;for(i=0;i<c;i++)(b=a.childNodes[i])&&"DIV"==b.tagName&&b.style&&"canvas"!=b.id&&"castBox"!=b.id&&(b.style.visibility="hidden"==b.style.visibility?"visible":"hidden")}if(b=getE("home_screen_header"))b.style.visibility="hidden"==b.style.visibility?"visible":"hidden";if(b=getE("notifications"))b.style.visibility="hidden"==b.style.visibility?"visible":"hidden";b=$("#stats2");b.css("display","none"==
b.css("display")?"block":"none")}var TO=null,TimeToFade=1500,HT;function kHT(a,b,c,d,f){if(b=getE("kHT"))d||(d=25E3),TO&&clearTimeout(TO),HT&&clearTimeout(HT),b.FadeTimeLeft=TimeToFade,b.style.display="block",replaceHTML4(b,a),fade("kHT"),TO=setTimeout("unkHT()",d)}function unkHT(){var a=getE("kHT");a&&(a.FadeTimeLeft=TimeToFade,fade("kHT",1))}
function fade(a,b){var c=getE(a);null!=c&&(c.FadeState=b?2:-2,c.FadeState=2==c.FadeState?-1:1,c.FadeTimeLeft=TimeToFade,HT=setTimeout("animateFade("+(new Date).getTime()+",'"+a+"')",33))}
function animateFade(a,b){var c=(new Date).getTime(),d=c-a;a=getE(b);a.FadeTimeLeft<=d?(a.style.opacity=1==a.FadeState?"1":"0",-1==a.FadeState?(a.style.display="none",a.style.top=0,a.style.left=0,a.FadeState=-2):a.FadeState=2):(a.FadeTimeLeft-=d,d=a.FadeTimeLeft/TimeToFade,1==a.FadeState&&(d=1-d),a.style.opacity=d,HT=setTimeout("animateFade("+c+",'"+b+"')",33))}
function kTT(a,b,c){if(tt){if(window.ENGINE&&ENGINE.isMobile)return!1;var d=gel("kTT");if(d){clearTimeout(TT);d.style.display="none";d.style.height="";d.style.width="";if(c)for(c=trim(c),c=c.split(";"),i=0;i<c.length;i++){var f=c[i].split(":");if(isNaN(f[0])&&f[1]){var g=trim(f[0]);f=trim(f[1]);switch(g){case "border":d.style.border=f;break;case "width":d.style.width=f;break;case "min-width":d.style.minWidth=f;break;case "max-width":d.style.maxWidth=f;break;case "height":d.style.height=f;break;case "min-height":d.style.minHeight=
f;break;case "max-height":d.style.maxHeight=f;break;case "padding":d.style.padding=f;break;case "background-color":d.style.backgroundColor=f;break;case "opacity":d.style.opacity=f/100,d.style.MozOpacity=f/100}}}d.style.display="block";c=a.pageY||a.clientY;a=a.pageX||a.clientX;g=document.body.clientWidth+parseInt(document.body.scrollLeft);parseInt(document.body.scrollTop);f=d.offsetWidth;var h=a+15;c=c-d.offsetHeight-5;a+f+20>g&&(h-=f+20);5>c&&(c=5);d.style.left=h+"px";d.style.top=c+"px";ttElement=
d;replaceHTML4(d,b);document.onmousemove=moveElement}}}function unkTT(){clearTimeout(TT);TT=setTimeout("runUnkTT()",25)}function runUnkTT(){var a=gel("kTT");a&&(a.style.display="none");TT&&(clearTimeout(TT),TT=null);cdElement||dragElement||(document.onmousemove=function(){return!1});ttElement=null}function mopen(a){resetZint2();mcancelclosetime();ddmenuitem&&(ddmenuitem.style.visibility="hidden");ddmenuitem=getE(a);ddmenuitem.style.visibility="visible"}
function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden")}function mclosetime(){closetimer=window.setTimeout(mclose,timeout)}function mcancelclosetime(){closetimer&&(clearTimeout(closetimer),closetimer=null)}
function initScroll(a,b,c,d,f){var g=window.event||a;if(g&&(a=getE("slider"+b))){var h=getE("scroll"+b);h&&(BEL=b,c&&(scrollSpeed=c),b=g.pageY||g.clientY,scY=parseInt(a.style.top),scStartY=b,cY=parseInt(h.style.top),cStartY=b,scrollTop=d,scrollBottom=f);document.onmousemove=scrollChat;document.onmouseup=cancelScroll;document.body.focus();document.onselectstart=function(){return!1};a.onselectstart=function(){return!1};return!1}}
function cancelScroll(){document.onselectstart=function(){return!0};document.onmousemove=null;document.onmouseup=null}
function scrollChat(a){var b=window.event||a;if(a=getE("slider"+BEL)){var c=getE("scroll"+BEL);if(c){b=scY+((b.pageY||b.clientY)-scStartY);if(0>b)return a.style.top="0px",!1!==scrollTop&&(c.style.top=scrollTop+"px"),!1;if(65<b)return a.style.top="65px",!1!==scrollBottom&&(c.style.top=scrollBottom+"px"),!1;var d=(1-b/65)*parseInt(c.style.height)+parseInt(scrollBottom);0<d&&(d=0);a.style.top=b+"px";c.style.top=d+"px";return!1}}}
function setScroll(a,b,c,d){var f=getE("scroll"+a);f&&parseInt(b)>parseInt(c)&&(f.style.top=Math.floor(-1*b)+"px",a=getE("slider"+a))&&(a.style.top=65*d+"px")}function keyup(a,b,c){switch(a){case 13:b||(b=worldUrl);if(a=getE("newchatT"))if(c=encodeURIComponent(a.value))a.value="",kajax("task=chat&chat="+c+"&top=1",null,function(a){ENGINE.doUpdate(a);unfocusChat()},b);break;case 27:unfocusChat()}}function giveFocus(a,b){(a=getE(a))&&a.focus()}
function initSendChat(){var a=loadPopWindow("chat_window",null,300,120);kajax("task=initSendChat",a,null,"/receive.php")}function sendChat(){var a=gel("chat_form");a&&a.value&&(a=a.value,unloadWindow("chat_window"),ENGINE&&ENGINE.conn&&(ENGINE.conn.sendChat(a),unfocusChat()))}function unfocusChat(){var a=getE("newchatT");ENGINE.canControl=!0;a&&a.blur()}function focusChat(){var a=getE("chatbarT");ENGINE.canControl=!1;return"none"!=a.style.display?(giveFocus("newchatT"),!0):!1}
function changeFrame(a,b){window.ENGINE&&kajax("task=changeFrame&frame="+(b||"t")+"&type="+a,null,function(a){ENGINE.doUpdate(a)},"/receive.php")}function addWhisper(a){ENGINE.canControl=!1;var b=getE("chatbarT");b&&"none"!=b.style.display&&addHTML("newchatT","/w "+a+" ")}function addItemLink(a){if(ENGINE.SHIFT&&0<parseInt(a)){ENGINE.canControl=!1;var b=getE("chatbarT");if(b&&"none"!=b.style.display)return b=getE("newchatT"),b.value+=" %i-"+a+" ",giveFocus(b.id),!0}return!1}
function updateItemStat(a,b,c){a&&kajax("task=updateItemStat&id="+b+"&stat="+c+"&val="+a.value,null,function(c){c=JSON.parse(c);if(c.error)alert(c.error);else if(c.success){"undefined"!==typeof c.value&&(a.value=c.value);if("undefined"!==typeof c.total){var d=gel("total_"+b);d&&(d.innerHTML=c.total)}var g=loadWindow("pop",null,200,80);g.innerHTML='<div style="padding:10px; text-align:center; font-weight:bold; color:#fff; line-height:60px; height:100%;">Item Updated!</div>';setTimeout(function(){unloadWindow(g)},
1E3)}},"/itemsheet.php")}function initAddNewItem(){var a=loadPopWindow("new_item_win",null,805,410);kajax("task=initAddNewItem",a,null,"/itemsheet.php")}function updateImageSelect(a){kajax("task=updateImageSelect&id="+a,"img_select",null,"/itemsheet.php")}function selectNewItemImg(a){$("#new_img_wrapper").find("img").css("border","1px solid #333");$("#new_item_img_"+a).css("border","1px solid orange");$("#new_item_img").val(a)}
function addNewItem(){var a=submitAjaxForm("new_item_form");if(a){if($("#npc_name_hidden").val()&&!$("#chance").val())return alert("Drop rate required with npc selection"),!1;log(a);kajax("task=addNewItem"+a,null,function(a){a=JSON.parse(a);if(a.error)alert(a.error);else if(a.success){unloadWindow("new_item_win");var b=loadWindow("pop",null,200,80);b.innerHTML='<div style="padding:10px; text-align:center; font-weight:bold; color:#fff; line-height:60px; height:100%;">Item Created!</div>';setTimeout(function(){unloadWindow(b)},
1E3);gel("itemsheet")&&loadWindow("itemsheet","/itemsheet.php",1550,930,null,40)}},"/itemsheet.php")}}function uploadAvatar(a,b,c){b=b||window.event;c=c||"userAvatar";a=new FormData(a);$.ajax({url:"receive.php",data:a,type:"POST",cache:!1,contentType:!1,processData:!1,success:function(a){if(a=JSON.parse(a))if(a.success){if(e=gel(c))e.src=a.success+"?time="+Math.random()}else a.err&&alert(a.err);return!1}});preventDefault(b);return!1}
function handleTriggers(a){var b,c=[];if(a){var d=a.split("|");var f=d.length;for(a=0;a<f;a++)if(b=d[a])if(b=b.split("#="),b[0])switch(b[1]&&(c=b[1].split("#:")),log("DEPRICATED :: "+b[0]),b[0]){case "ajax":c[1]||(c[1]=null);kajax(c[1],null,function(a){ENGINE.doUpdate(a)},c[0]);break;case "refresh":location.reload();break;case "href":b=c[0].replace("&amp;","&");location.href=b;break;case "tutorial":tutorial(c[1],c[2],c[0],c[3],c[4]);break;case "animation":ENGINE.CHAR&&ENGINE.CHAR.playAnimation(c[0],
0,!1,function(){ENGINE.CHAR.moving?ENGINE.CHAR.playAnimation("Run"):ENGINE.CHAR.underwater?ENGINE.CHAR.playAnimation("SwimIdle"):ENGINE.CHAR.playAnimation("Idle2")});break;case "kHT":showNotifications(c[0],c[3]);break;case "cast":ENGINE.initSpell(c[0],parseFloat(c[1]),c[2],c[3],c[4]);break;case "loadWindow":loadWindow(c[0],c[1]);break;case "unloadWindow":unloadWindow(c[0]);break;case "setScroll":setScroll(c[0],c[1],c[2],c[3]);break;case "loot":loadLoot(c[0]);break;case "close":if(b=getE(c[0]))b.style.display=
"none",replaceHTML4(b,"");break;case "eqopen":"1"==c[0]?eqopen=!0:eqopen=!1;break;case "sbopen":"1"==c[0]?sbopen=!0:sbopen=!1;break;case "train":"1"==c[0]?(canTrain=!0,ENGINE.canControl=!1):(canTrain=!1,ENGINE.canControl=!0);break;case "sound":ENGINE.SOUNDCONTROLLER.play(c[0]);break;case "note":showNotifications(c[0],c[1]);break;case "eval":eval(c[0])}}}
document.getElementsByClassName=function(a){var b=[];a=new RegExp("\\b"+a+"\\b");var c=this.getElementsByTagName("*");for(i=0;i<c.length;i++){var d=c[i].className;a.test(d)&&b.push(c[i])}return b};function theTime(){var a=new Date;return a.getSeconds()+60*a.getMinutes()+3600*a.getHours()+86400*a.getDay()}function microtime(a){var b=(new Date).getTime()/1E3,c=parseInt(b,10);return a?b:Math.round(1E3*(b-c))/1E3+" "+c}
function striptags(a){a=a.replace(/&(lt|gt);/g,function(a,c){return"lt"==c?"<":">"});return a=a.replace(/<\/?[^>]+(>|$)/g,"")}function trim(a,b){return ltrim(rtrim(a,b),b)}function ltrim(a,b){return a.replace(new RegExp("^["+(b||"\\s")+"]+","g"),"")}function rtrim(a,b){return a.replace(new RegExp("["+(b||"\\s")+"]+$","g"),"")}function addSlashes(a){return(a+"").replace(/[\\"']/g,"\\$&").replace(/\u0000/g,"\\0")}
function showLb(a){var b=gel("lb");b&&(b.style.display="block",a||(a=(a=getTopWindow())?Math.min(50,parseInt(a.style.zIndex)-1):50),b.style.zIndex=a)}function focusWindow(a){var b;if(a=getE(a)){var c=getWindows();var d=c.length;if(1<d)for(b=0;b<d;b++)if(c[b]){var f=c[b];f.id!=a.id&&(f.style.zIndex=50)}a.style.zIndex=51}}
function unloadWindow(a){var b,c;if(b=getE(a)){unkTT();a=b.id;if(c=getE(a+"_mask"))c.style.opacity=0,setTimeout(function(){unloadElement(c,"body")},400);if(b=getE(a))b.style.opacity=0;setTimeout(function(){ENGINE.canControl=!0},100);setTimeout(function(){unloadElement(a,"body");if(!getWindows().length){eqopen=sbopen=canTrain=!1;var b=gel("lb");b&&(b.style.display="none")}},400)}}function unloadAllWindows(){for(var a=getWindows(),b=0,c=a.length;b<c;b++)unloadWindow(a[b])}
function getWindows(){var a=[];$(".window, .window_mask").each(function(){a.push($(this)[0])});return a}function getTopWindow(){for(var a=null,b,c=0,d=getWindows(),f=0,g=d.length;f<g;f++)b=parseInt(d[f].style.zIndex),b>c&&(c=b,a=d[f]);return a}
function resizeWindows(){for(var a,b,c,d,f,g,h=getWindows(),k=0,m=h.length;k<m;k++)if(a=h[k])b=$("#"+a.id),c=b.width(),d=b.height(),g=parseInt(window.innerHeight),f=parseInt(window.innerWidth),d>=g?b.css({top:"0px","margin-top":"0px",height:g+"px"}):g>a.setHeight?b.css({top:"50%","margin-top":a.setHeight/-2+"px",height:a.setHeight+"px"}):d<a.setHeight?b.css({top:"50%","margin-top":g/-2+"px",height:g+"px"}):b.css({top:"50%","margin-top":d/-2+"px",height:d+"px"}),c>=f?b.css({left:"0px","margin-left":"0px",
width:f+"px"}):f>a.setWidth?b.css({left:"50%","margin-left":a.setWidth/-2+"px",width:a.setWidth+"px"}):d<a.setWidth?b.css({left:"50%","margin-left":f/-2+"px",width:f+"px"}):b.css({left:"50%","margin-left":c/-2+"px",width:c+"px"})}
function loadPopWindow(a,b,c,d,f,g,h,k){k=k||!1;var m;if(m=getE(a))return m;!k&&(m=getTopWindow())&&(k=m.cloneNode(),k.id=a+"_mask",k.className="window_mask",k.style.zIndex=parseInt(m.style.zIndex)+1,k.style.opacity=0,$("#"+k.id).css({opacity:0,WebkitTransition:"opacity 1s ease-in-out",MozTransition:"opacity 1s ease-in-out",MsTransition:"opacity 1s ease-in-out",OTransition:"opacity 1s ease-in-out",transition:"opacity 1s ease-in-out"}),getE("body").appendChild(k),k.style.opacity=.8);if(c=loadWindow(a,
b,c,d,f,g,null,null,h)){if(a=getE(c.id))a.style.opacity=1,a.style.borderRadius="10px",a.style.background="rgba(25,25,25,0.9)",a.style.padding="5px",a.style.border="1px solid #444";return c}}
function loadWindow(a,b,c,d,f,g,h,k,m){var l,n=h=!1,p=getE(a);if(l=p?p:document.createElement("div")){c||(c=971);d||(d=533);l.id=a;l.className="window";p=getTopWindow();l.style.zIndex=p?parseInt(p.style.zIndex)+1:51;c=parseInt(c);d=parseInt(d);l.setWidth=c;l.setHeight=d;p=window.innerHeight;var q=window.innerWidth;d>=p&&(d=p,g=0,h=!0);c>=q&&(c=q,f=0,n=!0);if(n||h)l.style.borderRadius="0px";0<c&&(l.style.marginLeft=-1*Math.min(Math.ceil(c/2),1E3)+"px",l.style.width=c+"px");0<d&&(l.style.marginTop=
-1*Math.min(Math.ceil(d/2),1E3)+"px",l.style.height=d+"px");if(0<f||n)l.style.marginLeft="0px",l.style.left=f+"px";if(0<g||h)l.style.marginTop="0px",l.style.top=g+"px";switch(a){case "tutorial":case "death":break;default:ENGINE.canControl=!1,l.onclick=function(a){ENGINE.canControl=!1}}l.innerHTML="";focusWindow(l.id);getE("body").appendChild(l);k&&showLb()}b?(b=b.split("?"),c=1<b.length?b[1]:null,b=b[0],kajax(c,null,function(a){ENGINE.doUpdate(a,m);l.style.opacity=1},b)):l.style.opacity=1;"function"==
typeof m&&m();return getE(a)}function transitionWindow(a,b){var c=getE(a);c&&(c.style.opacity=0,setTimeout(function(){c.innerHTML=b;c.style.opacity=1},410))}function setOpacity(){return!1}
function loadSocketWindow(a,b){var c=null,d=null;a||(a=window.event);if(b)a=[b];else{b=null!=a.target?a.target:a.srcElement;var f=getE("master"),g=document.body.clientWidth+parseInt(document.body.scrollLeft),h=document.body.clientHeight+parseInt(document.body.scrollTop);d=a.pageY||a.clientY;c=a.pageX||a.clientX;d-=parseInt(f.style.top);c-=parseInt(f.style.left);a=c+350;d+=parseInt(document.documentElement.scrollTop);a+20>g&&(c-=370);d+150+20>h&&(d-=170);a=b.id.split("-")}loadPopWindow("socket","socket.php?id="+
a[0],350,150,c,d)}function setLootPos(a){a=a||window.event;lootY=a.pageY||a.clientY;lootX=a.pageX||a.clientX}function loadLoot(a,b){a=a||window.event;var c=document.body.clientWidth+parseInt(document.body.scrollLeft),d=document.body.clientHeight+parseInt(document.body.scrollTop),f=a.pageY||a.clientY;a=a.pageX||a.clientX;a+226+20>c&&(a-=246);f+275+20>d&&(f-=295);loadWindow("lootBox","loot.php?id="+b,226,275,a,f)}var QS=[],QSTimer=null;
function showQSWindow(a,b){var c=$("#qsearch");if(!c.length){c=$("<div>");c.attr("id","qsearch");var d=gel(a.attr("id"));var f=document.body.getBoundingClientRect();var g=d.getBoundingClientRect();a=g.top-f.top+d.offsetHeight;f=g.left-f.left;c.css("min-width",d.offsetWidth+"px").css("min-height",d.offsetHeight+"px").css("background","#fff").css("position","absolute").css("top",a+"px").css("left",f+"px").css("z-index",1E9);$("body").append(c);$("body").click(function k(){"function"==typeof b&&b();
$("#qsearch").remove();$("body").off("click","body",k)})}return c}function setQuickSearch(a,b){var c;if(a=QS[a]){for(var d in a)if(c=gel(d))c.value=a[d];"function"==typeof b&&b()}$("#qsearch").remove()}
function quickSearch(a,b,c,d,f,g,h,k){var m,l,n;c=c||window.event;g=g||1;"undefined"==typeof c&&(c={});b=b||"searchNPC";d=d||"/receive.php";if(m=$(a))switch(c.keyCode){case 13:break;default:if((c=gel("DISABLEQS"))&&c.checked)return!1;(n=m.val())?n.length>=g?(clearTimeout(QSTimer),QSTimer=setTimeout(function(){(l=h?$("#"+h):showQSWindow(m,f))&&kajax("task="+b+"&text="+encodeURIComponent(n)+"&el="+a.id,null,function(a){if(a=JSON.parse(a))QS=a.qs,l.html(a.html)},d)},300)):($("#qsearch").remove(),$("#"+
a.id+"_hidden").val("")):$("#"+a.id+"_hidden").val("");"function"==typeof k&&k()}}function closePlayerMenu(a){var b=getE("playermenu");b&&(unloadWindow(b.id),a&&(ENGINE.canControl=!0))}function loadPlayerMenu(a,b){loadWindow("playermenu","/playerMenu.php?id="+b,250,150)}function unloadElement(a,b){if(a=getE(a))if(b=b||a.parentNode){if(b=getE(b))return b.removeChild(a),!0}else return document.body.removeChild(a),!0;return!1}
function addHTML(a,b,c){var d=getE(a);d&&(c||(c="start"),"INPUT"==d.nodeName?("start"==c?d.value=b+d.value:"end"==c&&(d.value+=b),giveFocus(a)):"start"==c?d.innerHTML=b+d.innerHTML:"end"==c&&(d.innerHTML+=b))}function kajax(a,b,c,d,f,g){ajaxQ||(ajaxQ=new ajaxQueue({limit:3}));d=d||worldUrl;ajaxQ.push({data:a,targObj:b,url:d,init:f,success:c})}
function qajax(a,b,c){kajax(b,null,function(a){if(a=$.parseJSON(a))if("notification"==c)showNotifications(a.out,3E3);else if(c=getE(c))c.innerHTML=a.html[0][1]},a)}
var ajaxQueue=function(a){this.q=[];this.r=null;this.limit=1;if(a){var b=this;jQuery.each(a,function(a,d){b[a]=d})}this.push=function(a){this.q.length<this.limit&&(this.q.push(a),this.run())};this.run=function(){var a=this;this.q.length&&!this.r&&(this.r=this.q.splice(0,1)[0])&&(this.r.init&&"function"==typeof this.r.init&&this.r.init(),jQuery.ajax({url:a.r.url||worldUrl,data:a.r.data,type:a.r.method||"POST",cache:!1,success:function(a,b,c){},complete:function(b,c,g){fakeProgress(0);if(a.r.targObj){var d=
getE(a.r.targObj);d&&(d.innerHTML=b.responseText)}"function"==typeof a.r.success&&a.r.success(b.responseText,c,g);"function"==typeof a.r.complete&&a.r.complete(b.responseText,c,g);a.r=null;a.run()},error:function(){"function"==typeof a.r.error&&a.r.error(xhr.responseText,status,err)}}))}};function loadProgress(a){var b;1==ENGINE.updateCounter&&(b=getE("loading_bar"))&&(b.style.width=100*a+"%",1==a&&(b.style.width="0%",b=getE("loading_msg")))&&(b.innerHTML="Loading Textures...")}var fakeTimer=null;
function fakeProgress(a,b,c){var d;b=b||100;c=parseFloat(c)||.1;clearTimeout(fakeTimer);fakeTimer=null;if("undefined"!=typeof ENGINE&&1==ENGINE.updateCounter||a)if(a+=c,1<a&&(a=1),0>a&&(a=0),d=getE("loading_bar"))if(d.style.width=100*a+"%",1==a){if(d.style.width="0%",d=getE("loading_msg"))d.innerHTML="Loading Textures..."}else 1>a&&(fakeTimer=setTimeout(function(){fakeProgress(a,b,c)},b))}
function clearFakeTimer(){var a;clearTimeout(fakeTimer);fakeTimer=null;if(a=getE("loading_msg"))a.innerHTML="Loading Textures...";if(a=getE("loading_bar"))a.style.width="5%"}
function Google_signIn(a){unloadAllWindows();var b="&browser="+navigator.sayswho+"&res_y="+window.screen.height+"&res_x="+window.screen.width+"&mobile="+(window.mobilecheck()?1:0);kajax("task=glogin&token_id="+a.getAuthResponse().id_token+b,null,function(a){window.gapi&&(gapi.auth2.getAuthInstance().signOut(),a=JSON.parse(a),a.error?(showNotifications(a.error,7E3),log(a.error)):a.data?ENGINE.reload(a):a.success&&location.reload())})}
function ajax(a,b,c){b=b||worldUrl;unkTT();if(ajaxQ){var d={};$(".window").find("[data-type='scroll']").each(function(){var a=$(this).attr("id");a&&(d[a]=$(this).scrollTop())});ajaxQ.push({data:a,url:b,success:function(a){ENGINE.doUpdate(a,c);for(var b in d)if(a=gel(b))a.scrollTop=d[b]}})}}function ajax2(a,b){a=a.split("?");ajax(a[1],a[0])}
function handleResponseElement(a,b){if(a=getE(a))b?("none"!=a.style.display&&a.style.display||(a.style.display="block"),replaceHTML4(a,b)):(a.style.display="none",replaceHTML4(a,""))}function editPost(a,b,c,d,f){var g=getE("post"+a);g&&(g.innerHTML='<textarea id="edit'+a+'" style="width:400px; height:200px;">'+f+"</textarea>");if(f=getE("actions"+a))f.innerHTML='[<a nohref=nohref style="cursor:pointer;" onclick="submitEdit('+a+","+b+","+c+","+d+');">Submit</a>]'}
function submitEdit(a,b,c,d){(a=getE("edit"+a))&&(a=a.value)&&qajax("forum.php","action=edit&page="+d+"&tid="+c+"&pid="+b+"&msg="+encodeURIComponent(a),"resp")}
function sendMail(a,b){b=b||0;var c=trim(encodeURIComponent(getE("msg").value)),d=trim(encodeURIComponent(getE("to").value)),f=trim(encodeURIComponent(getE("title").value));d||"legion"==opt?c?qajax("mail.php",a+"&msg="+c+"&title="+f+"&to="+d+"&reply="+parseInt(b),"mail"):getE("alert").innerHTML="You cannot send a blank message.":getE("alert").innerHTML="You cannot send mail to nobody."}function resetZint(){ENGINE.resetData&&ENGINE.resetData()}
function resetZint2(){ENGINE.resetData&&ENGINE.resetData()}
function loadHUD(a,b,c,d,f,g,h){url=h||"/receive.php";window.addEventListener("resize",resizeWindows,!1);if(window.mobilecheck()){if(a=gel("gphp_btn"))a.style.display="inline-block";if(a=gel("gregphp_btn"))a.style.display="inline-block";if(a=gel("greg_btn"))a.style.display="inline-block";if(a=gel("greg_top_btn"))a.style.display="inline-block"}else window.gapi&&!h&&gapi.signin2.render("greg_top_btn",{width:window.mobilecheck()?125:175,height:30,longtitle:!1,theme:"dark",onsuccess:Google_signIn});ajaxQ=
new ajaxQueue({limit:3});g=(g?"&b="+g:"")+("&browser="+navigator.sayswho+"&res_y="+window.screen.height+"&res_x="+window.screen.width+"&mobile="+(window.mobilecheck()?1:0)+"&module=1");kajax("task=loadHUD"+g,null,function(a){var b=JSON.parse(a);SETTINGS=b.settings;INITDATA=b.data;$("img").on("dragstart",function(a){a.preventDefault()});var c=document;a=c.getElementsByTagName("head")[0];c=c.createElement("script");c.type="module";c.id="game_module";b=atob(b.hud);c.innerHTML=b;a.appendChild(c);a.removeChild(c);
f&&initResetPass(f)},url,"POST")}var noteTimer=null;function showNotificationsOLD(a,b){var c,d;clearTimeout(noteTimer);noteTimer=null;if(c=getE("notifications"))if(d=getE("notifications_content")){d.innerHTML=a;a=d.offsetHeight;if(d=getE("notifications_bg"))d.style.height=a+"px";if(d=getE("home_screen_header"))a=d.offsetHeight,c.style.top=a+"px";c.style.opacity=1;b&&(noteTimer=setTimeout(function(){c.style.opacity=0},b))}}
function showNotifications(a,b){var c;clearTimeout(noteTimer);noteTimer=null;if(c=getE("notifications"))c.innerHTML=a,c.style.opacity=1,b&&(noteTimer=setTimeout(function(){c.style.opacity=0},b))}
function toggleDebug(a){var b=getE("debug");(ENGINE.DEBUG=a)?(ENGINE.stats2?ENGINE.stats2.domElement&&(ENGINE.stats2.domElement.style.display="block"):ENGINE.stats2=new Stats2,b&&(b.style.display="block")):(ENGINE.stats2&&ENGINE.stats2.domElement&&(ENGINE.stats2.domElement.style.display="none"),b&&(b.style.display="none"))}
function toggleStats(a){if(ENGINE.conn){var b=ENGINE.conn.monitorLag;ENGINE.conn.monitorLag=a;b||ENGINE.conn.measureLatency()}if(a)ENGINE.stats2?ENGINE.stats2.domElement&&(ENGINE.stats2.domElement.style.display="block"):ENGINE.stats2=new Stats2;else{if(a=getE("notifications"))a.style.opacity=0;ENGINE.stats2&&ENGINE.stats2.domElement&&(ENGINE.stats2.domElement.style.display="none")}}
function unstickUser(){kajax("task=unstickUser",null,function(a){a=JSON.parse(a);if(a.error){var b=getE("unstick_error");b?b.innerHTML=a.error:alert(a.error)}else a.data?(unloadWindow("unstick_win"),ENGINE.reload(a,!1)):a.success&&location.reload()},"receive.php")}function initUnstickUser(){var a=loadPopWindow("unstick_win",null,400,160);kajax("task=initUnstickUser",a,null,"/receive.php")}
function setResetPass(){var a=getE("reset_form"),b=submitAjaxForm(a,"","reset_error");b&&kajax("task=setResetpass"+b,null,function(b){if(b=JSON.parse(b))if(b.error){if(a=getE("reset_error"))a.innerHTML=b.error}else if(b.html){var c=getE("reset_window");c&&(c.innerHTML=b.html)}},"/receive.php")}
function resetPass(){var a=getE("reset_form"),b=submitAjaxForm(a,"","reset_error");b&&kajax("task=resetPass"+b,null,function(b){if(b=JSON.parse(b))if(b.error){if(a=getE("reset_error"))a.innerHTML=b.error}else if(b.html){var c=getE("reset_window");c&&(c.innerHTML=b.html)}},"receive.php")}function initSetResetPass(){var a=loadPopWindow("reset_window",null,400,160);kajax("task=initSetResetPass",null,function(b){(b=JSON.parse(b))&&b.html&&(a.innerHTML=b.html)},"/receive.php")}
function initResetPass(a){var b=loadPopWindow("reset_window",null,400,200);kajax("task=initResetPass&key="+a,null,function(a){(a=JSON.parse(a))&&a.html&&(b.innerHTML=a.html)},"/receive.php")}function submitNewBug(){var a;(a=submitAjaxForm("new_form"))&&kajax("task=submitNewBug"+a,null,function(a){if(a=JSON.parse(a))if(a.error){if(e=getE("error"))e.innerHTML=a.error}else a.html&&(ENGINE.handleHTML(a.html),unloadWindow("pop"))},"bugs.php")}
function reassignBug(){var a;if(a=submitAjaxForm("assign_form"))ajax("task=reassignBug"+a,"bugs.php"),unloadWindow("pop")}function ulog(a,b,c){b==(c||"u-1")&&log(a)}
function toggleChat(){var a=$("#uiBody1");if(a.length){var b=$("#wcombatlog"),c=$("#chatToggleBtn i");"none"==a.css("display")?kajax("task=setchattoggle&vis=1",null,function(d){JSON.parse(d).success&&(a.css("display","block"),b.css("bottom","252px"),a.scrollTop(a[0].scrollHeight),c.removeClass("fa-plus-square-o"),c.addClass("fa-minus-square-o"))}):kajax("task=setchattoggle&vis=0",null,function(d){JSON.parse(d).success&&(a.css("display","none"),b.css("bottom","92px"),c.removeClass("fa-minus-square-o"),
c.addClass("fa-plus-square-o"))})}};
